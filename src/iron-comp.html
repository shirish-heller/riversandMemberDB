<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/app-layout/app-layout.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/effects/waterfall.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-meta/iron-meta.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">


<dom-module id="iron-comp">
    <template>
        <style>

        :host {
            display: block;
            @apply --paper-font-common-base;
            font-family: sans-serif;
        }
        #logo{background:url(http://www.riversand.com/dev/wp-content/themes/theme-riversand/images/riversand_logo.svg) no-repeat;top:4px;left:12px;position:relative;height:43px;width:320px;display:inline-block;}
         
        .container {
            @apply --layout-horizontal;
            width: 100%;
        }

        .title {
            position: relative;
            display: inline-block;
            top:15px;
            margin-left: 18%;
        }

        @media (max-width: 480px) {
            #logo {
                width: 200px!important;
                top: 10px;
                margin-right: 30px!important;
            }

            app-toolbar {
                font-size: 15px!important;
            }
            .title {
                width: 60%;
            }
        }

        paper-item {
            background-color: white;
        }
        iron-list {
          padding-top: 64px;
          padding-bottom: 16px;
          --iron-list-items-container: {
            max-width: 800px;
            margin: auto;
            margin-top: 60px;
            margin-bottom: 10px;
          };
        }
        .list {
            height: 150vh;
            padding-bottom: 10px;
        }
        .Listitems {
          @apply --layout-vertical;
          margin: 16px 16px 0 16px;
          padding: 20px;
          border-radius: 8px;
          background-color: white;
          border: 1px solid #ddd;
          outline: none;
        }
        .Listitems:hover {
            box-shadow: 3px 8px 20px rgba(0,0,0,0.2);
        }

        app-toolbar {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          background: #F57C00;
          box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.3);
          color: white;
          z-index: 1;
          font-weight: bold;
          font-size: 18px;
          height: 80px;
        }
        .contactImg {
            height: 80px;
            width: 80px;
            border-radius: 50px;
            box-sizing: border-box;
            background-color: #ddd;
        }
        .names {
            padding: 0 16px;
          @apply --layout-flex;
          @apply --layout-vertical;
          font-weight: bold;
          padding-top: 30px;
        }
        .verticalLayout {
            @apply --layout-horizontal;
        }
        .menuIcon {
            --iron-icon-height: 35px;
            --iron-icon-width: 35px;
            border-radius: 15px;
            padding: 2px;
            border: 2px solid white;
            margin-right: 20px;
            /* padding-right: 30px; */
        }

        .menuIcon:hover {
            border-radius: 10px;
            border: 2px solid white;
            transition: background 0.2s, color 0.2s;
            transform: 0.2s, opacity 0.2s;
            transform: scale(1.1);
            background-color: white;
            color: #F57C00;
            box-shadow: 0 0 2px 2px #F57C00 inset;
            cursor: pointer;
        }
        
        .big {
            --iron-icon-height: 25px;
            --iron-icon-width: 25px;
            border-radius: 20px ;
            padding: 5px;
            border: 1px solid #eee;
            background-color: #eee;
            transform: rotate(-405deg);
            -webkit-transition: all .25s ease-in-out;
         }

         .big:hover {
            transition: background 0.2s, color 0.2s;
            transform: 0.2s, opacity 0.2s;
            transform: scale(0.9);
            transform: rotate(0deg);
            background-color: black;
            padding: 7px;
            color: white;
            box-shadow: 0 0 5px 6px #ddd;
            box-sizing: content-box;
            cursor: pointer;
            -webkit-transition: all .25s ease-in-out;
         }
         iron-icon.cross {
             color: #fff;
             --iron-icon-height: 32px;
             --iron-icon-width: 32px;
             background-color: #0474ff;
             opacity: 0.9;
             border-radius: 50%;
             /* transition: opacity 0.25 ease-in-out; */
             transform: rotate(720deg);
             
         }
         iron-icon.cross:hover {
             cursor: pointer;
             opacity: 0.5;
             
         }
         .sidepullup {
             width: 50%;
             box-shadow: -5px 0 10px 5px rgba(0,0,0,0.25);
             background-color: white;
             padding: 25px;
             position: fixed;
             right: 1px;
             top: 83px;
             margin-right: 5px;
             transition: all 1s ease-in-out;
             transition: background 0.2s, color 0.2s;
             visibility: visible;
         }
         /* To chance the pullup to cover entire width when screen is mobile size */
         @media(max-width: 480px) {
             .sidepullup {
                width: 85%;
             }
         }
         .sidepullup.hidePullup {
            right: -880px!important;
            box-shadow: 0 0 10px 5px rgba(0,0,0,0);
            transition: all 0.8s ease-in-out;
            visibility: hidden;
         }
         
            .fill:hover,
            .fill:focus {
                box-shadow: inset 0 0 0 2em #7ddaff;
            }

            .fill {
             --color: #00a2e3;
             --hover: #7ddaff;
            }

             button {
                color: #00a2e3;
                -webkit-transition: 0.25s;
                transition: 0.25s;
                }
            button:hover, button:focus {
                border-color: #7ddaff;
                color: #fff;
                font-weight: bold;
                }
            button {
                 background: none;
                border: 2px solid #00a2e3;
                 font: inherit;
                 line-height: 0.2;
                 margin: 0.5em;
                 padding: 1em 2em;
                 font-weight: bold;
                }

            .loadingIndicator {
                 text-align: center;
                 height: 40px;
            }
            paper-spinner {
          width: 20px;
          height: 20px;
          margin-right: 10px;
        }
        </style>
        <app-toolbar>
            <div class="container">
                    <span class="classLogo" id="logo"></span>
                    <!-- <iron-icon icon="menu" class="menuIcon"></iron-icon> -->
                    <span class="title">MEMBER DATABASE</span>
            </div>
                
        </app-toolbar>
<!-- Iron Ajax -->
        <iron-ajax id="ajax" url="https://api.myjson.com/bins/nn2v7" handle-as="json" last-response="{{items}}" on-response="_didRespond" auto></iron-ajax>
<!-- Iron List -->
        <iron-list id="list" items="[]" as="person" scroll-target="document" selected-item="{{selectedItem}}" on-selected-item-changed="[[selectionChanged(selectedItem)]]" selection-enabled>
                <template>
                    <div>
                            <div id="idlist" class="Listitems" tabindex$="[[tabIndex]]">                     
                                    
                                <div class="verticalLayout">
                                        <iron-image class="contactImg" preload fade alt="Contact Image" sizing="contain" src="[[person.pic]]"></iron-image>
                                    
                                        <div class="names">
                                            {{person.first}} {{person.last}}
                                        </div>
                                        
                                        <iron-icon class="big ripple" on-click="onEdit" icon="create"></iron-icon>
                                </div>
                                    
                                        
                                    <div>
                                        <paper-item> <b>Title:&nbsp</b>{{person.title}}</paper-item> 
                                    </div>
                                      
                                    <div>
                                        <paper-item><label><b>About:&nbsp</b></label><span>{{person.body}}</span></paper-item> 
                                    </div>
                            </div>
                                    
                    </div>
                  
                </template>
         </iron-list> 

<!-- Loading -->
        <div class="loadingIndicator">
            <paper-spinner active="{{items}}"></paper-spinner> Fetching data
        </div>

 <!-- this element will load more data when the user scrolls down and reached the lower threshold -->
      <iron-scroll-threshold id="scrollTheshold"
      lower-threshold="500"
      on-lower-threshold="_load"
      scroll-target="document"></iron-scroll-threshold>

 <!-- Side Pull up Form -->

         <div class="sidepullup hidePullup" id="idSidePullup">
            <iron-icon class="cross" id="idCross" on-click="pullupClose" icon="close"></iron-icon>
            <iron-form id="form1">
                <form action="/">
                    <paper-input type"text" id="idfirstName" name="firstName" label="First Name"></paper-input>
                    <paper-input type="text" id="idlastName" name="lastName" label="Last Name"></paper-input>
                    <paper-input type="text" id="idtitle" name="title" label="Title"></paper-input>
                    <paper-input type="text" id="idabout" name="about" label="About"></paper-input>
                    <!-- <paper-button type="submit" style="background-color: #03a9f4; color: white" raised on-click="onFormSubmit">Submit Changes</paper-button> -->
                    <button class="submitBtn fill" on-click="onFormSubmit">Submit Changes</paper-button>
                </form>
                <br/>
                <div class="output"></div>
            </iron-form>
         </div>

        
    </template>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        class IronListClass extends Polymer.Element {
            static get is() {return 'iron-comp'}
            static get properties() {
                return {
                    selectedItem: {
                        type: Object,
                        notify: true,
                        reflectToAttribute: true
                    }
                }
            }

            // static get properties() {
            //     return {
            //         url: {
            //             type: String,
            //             value() {return "./data/employees.json"}
            //         }
            //     }
            // }

            // static get observers() { return ['checkJsonFileLoaded(items)']}

            //     checkJsonFileLoaded(j) {
            //     if (j) {
            //         this.set('items', j);
            //         console.log(items); //u should see the loaded json file. If so than the problem is iron-list (to publish the result)
            //     }
            // }

            ready() {
                super.ready();
            }

            pullupClose() {
                var pullUp= $(Polymer.dom(this.root).querySelector('#idSidePullup'));
                pullUp.addClass('hidePullup');                
                var cross= $(Polymer.dom(this.root).querySelector('#idCross'));
                cross.css({"transform": "rotate(720deg)", "-webkit-transition": "all 1s ease-in-out"});
                // $(Polymer.dom(this.root).querySelector('#idForm')).reset();
            }  
            onEdit() {
            }
            selectionChanged(selectedItem) {
                if(selectedItem!==null) {
                    var cross= $(Polymer.dom(this.root).querySelector('#idCross'));
                    cross.css({"transform": "rotate(0deg)", "-webkit-transition": "all 1s ease-in-out"});
                    var element= $(Polymer.dom(this.root).querySelector('#idSidePullup'));
                    element.removeClass('hidePullup');
                    element.css("-webkit-transition", "all 1s ease-in-out");
                    console.log(this.selectedItem);
                }                
            }

            onFormSubmit() {         
                this.set('selectedItem.first', this.$['idfirstName'].value);
                this.set('selectedItem.last', this.$['idlastName'].value);
                this.set('selectedItem.title', this.$['idtitle'].value);
                this.set('selectedItem.body', this.$['idabout'].value);
                this.$.form1.reset();
                this.pullupClose();
            }

            connectedCallback() {
                super.connectedCallback();
                const form = this.$['form1'];
                var that = this;
                form.addEventListener('iron-form-submit', function (event, that) {
                event.preventDefault();
                });
      }

      _load() {
          this.$.ajax.generateRequest();
        }

        _didRespond(e) {
          var people = e.detail.response.results;
          people.forEach(function(person) {
            this.$.list.push('items', person);
          }, this);
          // Clear the lower threshold so we can load more data when the user scrolls down again.
          this.$.scrollTheshold.clearTriggers();
        }
   }
        window.customElements.define(IronListClass.is, IronListClass);
    </script>
</dom-module>